<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Setup & Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 40px; 
            background: #f8fafc; 
            color: #334155; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto;
        }
        .card { 
            background: white; 
            padding: 24px; 
            border-radius: 12px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            margin: 20px 0; 
        }
        .status { 
            padding: 16px; 
            border-radius: 8px; 
            margin: 16px 0; 
        }
        .success { 
            background: #dcfce7; 
            border: 1px solid #bbf7d0; 
            color: #166534; 
        }
        .error { 
            background: #fef2f2; 
            border: 1px solid #fecaca; 
            color: #dc2626; 
        }
        .info { 
            background: #dbeafe; 
            border: 1px solid #bfdbfe; 
            color: #1d4ed8; 
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            color: #b45309;
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-primary { 
            background: #3b82f6; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #2563eb; 
        }
        .btn-success { 
            background: #10b981; 
            color: white; 
        }
        .btn-success:hover { 
            background: #059669; 
        }
        .btn-warning { 
            background: #f59e0b; 
            color: white; 
        }
        .btn-warning:hover { 
            background: #d97706; 
        }
        pre { 
            background: #f1f5f9; 
            padding: 16px; 
            border-radius: 8px; 
            overflow-x: auto; 
            font-size: 14px; 
        }
        h1, h2, h3 { 
            color: #1e293b; 
        }
        .step { 
            counter-increment: step; 
        }
        .step::before { 
            content: counter(step); 
            background: #3b82f6; 
            color: white; 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            margin-right: 12px; 
            font-size: 14px; 
            font-weight: bold; 
        }
        .steps { 
            counter-reset: step; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è Admin Panel Setup & Testing</h1>
        
        <div class="card">
            <h2>Quick Setup</h2>
            <p>Follow these steps to set up your admin panel with sample data:</p>
            
            <div class="steps">
                <div class="step">
                    <strong>Check Authentication Status</strong>
                    <button class="btn-primary" onclick="checkAuth()">Check Auth Status</button>
                </div>
                
                <div class="step">
                    <strong>Make Yourself Admin</strong>
                    <button class="btn-success" onclick="makeAdmin()">Promote to Admin</button>
                </div>
                
                <div class="step">
                    <strong>Create Sample Data</strong>
                    <button class="btn-warning" onclick="createSampleData()">Create Sample Auctions</button>
                </div>
            </div>
        </div>

        <div id="authResult" class="status info" style="display: none;">
            <h3>Authentication Status</h3>
            <pre id="authDetails"></pre>
        </div>

        <div id="adminResult" class="status" style="display: none;">
            <h3>Admin Promotion Result</h3>
            <pre id="adminDetails"></pre>
        </div>

        <div id="dataResult" class="status" style="display: none;">
            <h3>Sample Data Creation Result</h3>
            <pre id="dataDetails"></pre>
        </div>

        <div class="card">
            <h2>üéØ Quick Links</h2>
            <p>Once setup is complete, access these admin features:</p>
            <div>
                <a href="/admin" target="_blank">
                    <button class="btn-primary">Admin Dashboard</button>
                </a>
                <a href="/admin/manage" target="_blank">
                    <button class="btn-primary">Manage Users & Auctions</button>
                </a>
                <a href="/auctions" target="_blank">
                    <button class="btn-primary">View Auctions (Public)</button>
                </a>
            </div>
        </div>

        <div class="card">
            <h2>üìã Features Available</h2>
            <ul>
                <li><strong>‚úÖ Delete Auctions:</strong> Remove any auction from the system</li>
                <li><strong>‚úÖ Remove Users:</strong> Delete users with data preservation options</li>
                <li><strong>‚úÖ Modify Auction Status:</strong> Change auction status (active, pending, closed, cancelled)</li>
                <li><strong>‚úÖ User Management:</strong> Activate/deactivate users, view details</li>
                <li><strong>‚úÖ Platform Analytics:</strong> View user stats, auction metrics, recent activity</li>
                <li><strong>‚úÖ Search & Filter:</strong> Find specific users or auctions quickly</li>
            </ul>
        </div>
    </div>

    <script>
        async function checkAuth() {
            try {
                const response = await fetch('/api/admin/check-auth');
                const data = await response.json();
                
                const resultDiv = document.getElementById('authResult');
                const detailsDiv = document.getElementById('authDetails');
                
                resultDiv.style.display = 'block';
                detailsDiv.textContent = JSON.stringify(data, null, 2);
                
                if (data.authenticated && data.user && data.user.role === 'admin' && data.admin && data.admin.isActive) {
                    resultDiv.className = 'status success';
                    resultDiv.innerHTML = '<h3>‚úÖ Authentication Status</h3><p>You are properly authenticated as an admin!</p><pre id="authDetails"></pre>';
                } else if (data.authenticated && data.user) {
                    resultDiv.className = 'status warning';
                    resultDiv.innerHTML = '<h3>‚ö†Ô∏è Authentication Status</h3><p>You are logged in but not an admin. Click "Promote to Admin" button.</p><pre id="authDetails"></pre>';
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.innerHTML = '<h3>‚ùå Authentication Status</h3><p>You are not logged in. Please <a href="/auth/signin">sign in</a> first.</p><pre id="authDetails"></pre>';
                }
                
                document.getElementById('authDetails').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('authResult').style.display = 'block';
                document.getElementById('authResult').className = 'status error';
                document.getElementById('authDetails').textContent = 'Error: ' + error.message;
            }
        }

        async function makeAdmin() {
            try {
                const response = await fetch('/api/admin/make-admin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('adminResult');
                const detailsDiv = document.getElementById('adminDetails');
                
                resultDiv.style.display = 'block';
                detailsDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    resultDiv.className = 'status success';
                    resultDiv.innerHTML = '<h3>‚úÖ Admin Promotion Successful</h3><p>You are now an admin! You can access the admin panel.</p><pre id="adminDetails"></pre>';
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.innerHTML = '<h3>‚ùå Admin Promotion Failed</h3><pre id="adminDetails"></pre>';
                }
                
                document.getElementById('adminDetails').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('adminResult').style.display = 'block';
                document.getElementById('adminResult').className = 'status error';
                document.getElementById('adminDetails').textContent = 'Error: ' + error.message;
            }
        }

        async function createSampleData() {
            try {
                const response = await fetch('/api/admin/create-sample-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                
                const resultDiv = document.getElementById('dataResult');
                const detailsDiv = document.getElementById('dataDetails');
                
                resultDiv.style.display = 'block';
                detailsDiv.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    resultDiv.className = 'status success';
                    resultDiv.innerHTML = '<h3>‚úÖ Sample Data Created</h3><p>Sample auctions, users, and bids have been created! You can now test the admin panel features.</p><pre id="dataDetails"></pre>';
                } else {
                    resultDiv.className = 'status error';
                    resultDiv.innerHTML = '<h3>‚ùå Sample Data Creation Failed</h3><pre id="dataDetails"></pre>';
                }
                
                document.getElementById('dataDetails').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('dataResult').style.display = 'block';
                document.getElementById('dataResult').className = 'status error';
                document.getElementById('dataDetails').textContent = 'Error: ' + error.message;
            }
        }

        // Auto-check auth on page load
        window.addEventListener('load', checkAuth);
    </script>
</body>
</html>